# AI规则

了解如何使用项目特定和全局规则自定义Cursor中的AI行为

使用Cursor中的规则，您可以控制底层模型的行为。您可以将其视为LLMs的指令和/或系统提示。

在Cursor中，我们有两种主要方式来自定义AI行为以满足您的需求：

## 项目规则

特定于项目的规则，存储在`.cursor/rules`目录中。当引用匹配的文件时，这些规则会自动包含在内。

## 全局规则

应用于所有项目的全局规则，在`Cursor Settings` > `General` > `Rules for AI`部分进行配置。

在以下部分中了解有关如何使用它们的更多信息。

## 项目规则（推荐）

项目规则提供了一个强大而灵活的系统，具有路径特定的配置。项目规则存储在`.cursor/rules`目录中，并提供对项目不同部分的AI行为的精细控制。

以下是它们的工作原理：

* **语义描述**：每条规则可以包含应用时机的描述
* **文件模式匹配**：使用glob模式指定规则适用的文件/文件夹
* **自动附加**：当引用匹配的文件时，规则可以自动包含
* **引用文件**：在项目规则中使用@file，以便在应用规则时将它们包含为上下文

您可以使用@file引用规则文件，允许您将多个规则链接在一起

您可以使用命令面板通过`Cmd + Shift + P` > `New Cursor Rule`创建新规则。通过使用项目规则，您还可以获得版本控制的好处，因为它只是一个文件

示例用例：

* 特定文件类型的框架特定规则（例如，`.tsx`文件的SolidJS偏好）
* 自动生成文件的特殊处理（例如，`.proto`文件）
* 自定义UI开发模式
* 特定文件夹的代码风格和架构偏好

## 全局规则

通过修改`Cursor Settings` > `General` > `Rules for AI`部分下的`Rules for AI`，可以添加全局规则。如果您想指定在每个项目中始终包含的规则，如输出语言、响应长度等，这非常有用。

### 全局规则示例

以下是一个全局规则的示例，可以在Cursor设置中配置：

```
1. 错误修复：
   - 在建议修复之前彻底分析问题
   - 提供精确、有针对性的解决方案
   - 解释错误的根本原因

2. 保持简单：
   - 优先考虑可读性和可维护性
   - 避免过度工程化解决方案
   - 尽可能使用标准库和模式

3. 代码更改：
   - 在进行更改之前提出明确的计划
   - 一次性应用对单个文件的所有修改
   - 不要修改不相关的文件

请始终考虑每个项目的上下文和特定要求。
```

### 全局规则与项目规则的关系

在`Cursor Settings` > `General`中，您会看到两个相关设置：
- `Rules for AI`文本区域：用于输入全局规则
- `Include .cursorrules file`切换选项：启用后，Cursor会在全局规则的基础上添加项目特定的规则

全局规则适用于所有项目，而项目规则仅适用于特定项目。当两者同时存在时，项目规则会附加到全局规则之后。

## `.cursorrules`

为了向后兼容，您仍然可以在项目根目录中使用`.cursorrules`文件。我们将来会最终移除.cursorrules，因此我们建议迁移到新的项目规则系统，以获得更好的灵活性和控制。

### `.cursorrules`文件位置和用法

`.cursorrules`文件应放置在项目的根目录中，类似于`.gitignore`文件。每个项目通常只有一个`.cursorrules`文件。

`.cursorrules`文件中的规则不会自动添加到全局`Rules for AI`设置中，它们是独立的。要使用`.cursorrules`文件，您需要确保在Cursor设置中启用了`Include .cursorrules file`选项。

### `.cursorrules`文件示例

以下是一个`.cursorrules`文件的示例，专注于TypeScript和React开发：

```
您是TypeScript、Node.js、Next.js App Router、React、Shadcn UI、Radix UI和Tailwind的专家。

代码风格和结构
- 编写简洁、技术性的TypeScript代码，提供准确的示例。
- 使用函数式和声明式编程模式；避免使用类。
- 优先使用迭代和模块化而非代码重复。
- 使用描述性变量名，带有辅助动词（例如，isLoading、hasError）。
- 文件结构：导出组件、子组件、辅助函数、静态内容、类型。

命名约定
- 目录使用小写字母和破折号（例如，components/auth-wizard）。
- 组件优先使用命名导出。

TypeScript使用
- 所有代码都使用TypeScript；接口优于类型。
- 避免使用枚举；使用映射代替。
- 使用带有TypeScript接口的函数组件。

语法和格式
- 对纯函数使用"function"关键字。
- 在条件语句中避免不必要的花括号；对简单语句使用简洁语法。
- 使用声明式JSX。

UI和样式
- 使用Shadcn UI、Radix和Tailwind进行组件和样式设计。
- 使用Tailwind CSS实现响应式设计；采用移动优先的方法。

性能优化
- 最小化'use client'、'useEffect'和'setState'的使用；优先使用React服务器组件（RSC）。
- 使用Suspense包装客户端组件，提供fallback。
- 对非关键组件使用动态加载。
- 优化图像：使用WebP格式，包含尺寸数据，实现懒加载。

关键约定
- 使用'nuqs'进行URL搜索参数状态管理。
- 优化Web Vitals（LCP、CLS、FID）。
- 限制'use client'的使用：
  - 优先使用服务器组件和Next.js SSR。
  - 仅在小型组件中用于Web API访问。
  - 避免用于数据获取或状态管理。

遵循Next.js文档中关于数据获取、渲染和路由的指导。
```

## 规则格式

规则文件使用JSON格式，允许您定义应用规则的条件和指令。以下是一个基本的规则文件结构：

```json
{
  "when": "这是一个描述规则应用时机的语义描述",
  "apply": [
    "这些是应用于匹配文件的指令",
    "可以有多行指令"
  ],
  "files": [
    "**/*.tsx",
    "**/*.jsx"
  ]
}
```

### 规则字段说明

- **when**：描述规则应用的条件或上下文
- **apply**：应用于匹配文件的指令列表
- **files**：使用glob模式指定规则适用的文件

## 规则示例

### React组件规则

```json
{
  "when": "处理React组件文件",
  "apply": [
    "使用函数组件而不是类组件",
    "使用React Hooks管理状态",
    "遵循组件命名约定：PascalCase",
    "将样式放在单独的CSS模块文件中"
  ],
  "files": [
    "src/components/**/*.tsx",
    "src/components/**/*.jsx"
  ]
}
```

### API处理规则

```json
{
  "when": "处理API相关代码",
  "apply": [
    "使用try/catch块处理所有API调用",
    "实现错误处理和重试逻辑",
    "使用环境变量存储API端点",
    "遵循RESTful API设计原则"
  ],
  "files": [
    "src/api/**/*.ts",
    "src/services/**/*.ts"
  ]
}
```

### 测试文件规则

```json
{
  "when": "编写或修改测试文件",
  "apply": [
    "使用描述性测试名称",
    "遵循AAA模式：Arrange, Act, Assert",
    "每个测试只测试一个行为",
    "使用模拟对象隔离外部依赖"
  ],
  "files": [
    "**/*.test.ts",
    "**/*.spec.ts",
    "tests/**/*.ts"
  ]
}
```

## 为什么使用AI规则？

使用AI规则有以下几个重要原因：

1. **项目上下文理解**：为AI提供关于项目结构、技术和特定需求的关键信息
2. **自适应行为**：根据AI的表现调整其响应，使您能够随时间微调其行为
3. **错误纠正**：澄清误解并引导AI避免常见错误，提高其建议和代码生成的准确性
4. **定制化AI行为**：使AI的响应更符合您项目的特定需求，确保更相关和准确的代码建议
5. **一致性**：通过在AI规则中定义编码标准和最佳实践，确保AI生成的代码符合您项目的风格指南
6. **团队协作**：对于团队项目，共享的规则文件确保所有团队成员获得一致的AI辅助，促进编码实践的凝聚力

## 编写有效规则的技巧

对于Cursor新用户，以下是一些帮助您编写有效规则的技巧：

1. **从简单开始**：从反映您的即时需求或常见编码实践的基本指令开始
2. **具体明确**：清楚地说明您的偏好或要求。例如，"使用2个空格进行缩进"比"使用适当的缩进"更有效
3. **使用自然语言**：用简单的语言编写规则。AI设计为理解自然语言指令
4. **优先考虑重要规则**：首先列出最关键的规则，因为它们对AI行为的影响最强
5. **迭代和完善**：随着您使用Cursor的时间增加，您会发现AI可以在哪些方面提供更多帮助。相应地更新您的规则

## 最佳实践

### 规则组织

- 为不同的文件类型或项目区域创建单独的规则
- 使用有意义的文件名，如`react-components.json`或`api-services.json`
- 将相关规则放在一起，以便于维护

### 规则编写

- 保持指令清晰简洁
- 使用具体的例子说明您的偏好
- 避免过于严格的规则，允许一定的灵活性
- 定期更新规则以反映项目的演变
- 确保规则之间不相互矛盾
- 涵盖多个方面：编码风格、文档、错误处理和性能考虑
- 包括项目特定的上下文：提及重要的项目细节，如主要编程语言、框架或独特的架构决策
- 平衡灵活性和严格性：允许AI提出创新解决方案的同时，仍然遵循您的核心原则

### 规则共享

- 将规则文件添加到版本控制中，以便团队成员共享
- 在团队文档中记录规则的目的和使用方法
- 考虑创建一个规则模板库，供新项目使用

## 常见问题

### 如何在多语言项目中使用规则？

对于包含多种编程语言的项目，建议使用文件模式匹配来为不同语言创建特定规则。例如：

```json
{
  "when": "处理Python文件",
  "apply": [
    "遵循PEP 8风格指南",
    "使用类型注释"
  ],
  "files": [
    "**/*.py"
  ]
}
```

```json
{
  "when": "处理JavaScript文件",
  "apply": [
    "使用ES6+语法",
    "优先使用const和let而非var"
  ],
  "files": [
    "**/*.js",
    "**/*.jsx"
  ]
}
```

### 规则文件能否读取本地目录并扫描文件？

目前，规则文件本身不能直接读取和扫描目录。但是，您可以在规则中明确提及重要的文件路径和结构，以便AI了解您的项目组织。

### 如何解决规则冲突？

当多个规则适用于同一文件时，可能会出现冲突。为了解决这个问题：

1. 确保规则的优先级明确
2. 使用更具体的文件模式来减少重叠
3. 在规则中明确说明例外情况

通过有效使用AI规则，您可以确保Cursor的AI助手始终按照您的项目标准和偏好工作，提高代码质量和一致性。 