# 代码库索引

了解如何在Cursor中为您的代码库建立索引，以获得更准确的AI辅助和搜索结果

## 为您的代码库建立索引

为了获得更好、更准确的代码库回答，您可以为代码库建立索引。在后台，Cursor会为代码库中的每个文件计算嵌入向量，并使用这些向量来提高代码库回答的准确性。

Cursor为每个用户维护单独的代码库索引。完成初始索引设置后，Cursor会自动为添加到工作区的任何新文件建立索引，以保持您的个人代码库上下文的最新状态。

您可以在`Cursor Settings` > `Features` > `Codebase Indexing`下查看代码库索引的状态。

![代码库索引设置](https://mintlify.s3.us-west-1.amazonaws.com/cursor/images/codebase-indexing/indexing-settings.png)

## 高级设置

默认情况下，Cursor会为代码库中的所有文件建立索引。

您还可以展开`Show Settings`部分以访问更多高级选项。在这里，您可以决定是否要为新仓库启用自动索引，并配置Cursor在仓库索引期间将忽略的文件。

Cursor使用与VS Code相同的包来处理文件忽略，这意味着它会遵循所有`.gitignore`文件，包括子目录中的文件。您还可以创建一个`.cursorignore`或`.cursorindexingignore`文件来设置用户特定的忽略模式，您可能希望将其添加到全局`.gitignore`中，以避免将其提交到仓库。

如果您的项目中有AI绝对不需要读取的大型内容文件，忽略这些文件可能会提高回答的准确性。

## 忽略文件

Cursor提供了两种不同的忽略文件来控制文件的处理方式：

### `.cursorignore`

`.cursorignore`文件尝试尽最大努力将文件从AI功能和索引中排除。这对以下情况非常有用：

* 尝试从AI访问和索引中排除敏感文件
* 排除包含机密信息的配置文件
* 限制对专有代码的访问

列在`.cursorignore`中的文件将尽最大努力从Cursor的AI功能中排除：

* 不包含在Tab和聊天请求中
* 不包含在AI功能的上下文中
* 不为搜索或上下文功能建立索引
* 不通过@符号或其他上下文工具可用

### `.cursorindexingignore`

`.cursorindexingignore`文件自动继承您的`.gitignore`文件中的所有模式。

`.cursorindexingignore`文件仅控制哪些文件为搜索和上下文功能建立索引。这提供了与旧版`.cursorignore`相同的索引控制。在以下情况下使用此文件：

* 从索引中排除大型生成的文件
* 跳过对二进制文件的索引
* 控制代码库的哪些部分可搜索
* 优化索引性能

重要提示：`.cursorindexingignore`中的文件仍然可以手动包含为上下文或被AI功能访问 - 它们只是不会自动建立索引或包含在搜索结果中。

### 文件格式

两种文件都使用与`.gitignore`相同的语法。以下是一些示例：

#### 基本模式

```sh
# 忽略`dist`目录中的所有文件
dist/

# 忽略所有`.log`文件
*.log

# 忽略特定文件`config.json`
config.json
```

#### 高级模式

仅包含`app`目录中的`*.py`文件：

```sh
# 忽略所有内容
*
# 不要忽略app
!app/
# 不要忽略app内的目录
!app/*/
!app/**/*/
# 不要忽略python文件
!*.py
```

## 处理大型单体仓库

在处理包含数十万个文件的大型单体仓库时，对索引内容进行战略性规划非常重要。

* 使用`.cursorignore`或`.cursorindexingignore`让每个开发人员配置他们在单体仓库中工作的文件夹和路径
* 将这些忽略文件添加到您的全局`.gitignore`中

这允许每个开发人员针对单体仓库内的特定工作区域优化索引。

### 单体仓库示例

假设您正在处理一个包含多个微服务的大型单体仓库，您可以创建如下的`.cursorindexingignore`文件：

```sh
# 忽略所有内容
*

# 只索引您正在处理的微服务
!services/auth-service/
!services/user-service/

# 忽略所有微服务中的node_modules
services/*/node_modules/

# 忽略所有测试数据
**/test/data/

# 忽略所有构建输出
**/dist/
**/build/
```

## 常见问题

### 我在哪里可以查看我已索引的所有代码库？

目前，没有办法查看您已索引的所有代码库的列表。您需要通过在Cursor中打开项目并检查代码库索引设置来手动检查每个项目的索引状态。

### 如何删除所有代码库？

您可以从设置中删除Cursor账户以删除所有已索引的代码库，或者从每个项目的代码库索引设置中手动删除单个代码库。目前，没有办法在不删除账户的情况下一次性删除所有代码库。

### 忽略文件不起作用怎么办？

如果您的忽略文件似乎不起作用，请尝试以下故障排除步骤：

1. 确保忽略文件位于项目的根目录
2. 检查文件名是否正确（`.cursorignore`或`.cursorindexingignore`）
3. 验证文件权限是否正确
4. 尝试使用更简单的模式，然后逐步添加复杂性
5. 重新启动Cursor以确保更改生效

### 忽略文件语法问题

忽略文件语法完全遵循`.gitignore`。如果遇到问题：

1. 在搜索查询中将"cursorignore"替换为"gitignore"
2. 在Stack Overflow上查找类似的模式
3. 使用`git check-ignore -v [文件]`测试模式以了解匹配情况

常见陷阱：

* 模式相对于忽略文件位置进行匹配
* 后面的模式会覆盖前面的模式
* 目录模式需要尾部斜杠
* 否定模式（`!`）必须否定前面的模式

## 索引过程详解

### 索引是如何工作的？

当您为代码库建立索引时，Cursor会执行以下步骤：

1. 扫描工作区中的所有文件（遵循忽略规则）
2. 为每个文件生成嵌入向量表示
3. 将这些嵌入存储在本地数据库中
4. 在需要时使用这些嵌入来提高AI回答的相关性和准确性

### 索引的好处

为代码库建立索引可以带来以下好处：

* **更准确的代码理解**：AI能够更好地理解您的代码库结构和关系
* **更相关的回答**：回答会更加针对您的特定代码库和上下文
* **更快的响应时间**：在某些情况下，索引可以加快AI的响应速度
* **减少上下文切换**：AI可以更有效地利用代码库知识，减少您需要提供的额外上下文

## 最佳实践

为了获得最佳的代码库索引体验，请考虑以下建议：

### 优化索引范围

* 只索引您实际需要AI帮助的代码
* 使用忽略文件排除生成的文件、二进制文件和大型数据文件
* 对于非常大的代码库，考虑只索引您当前工作的部分

### 保持索引最新

* 定期检查索引状态，确保它是最新的
* 在进行重大代码更改后，考虑重新索引代码库
* 确保自动索引功能已启用，以便新添加的文件能够自动被索引

### 解决常见问题

* 如果索引似乎卡住了，尝试重启Cursor
* 对于非常大的代码库，索引可能需要一些时间，请耐心等待
* 如果索引后AI回答质量没有提高，检查您的忽略设置，确保重要文件没有被排除

### 索引性能优化

* 对于大型代码库，考虑分阶段索引，先索引核心部分
* 排除不需要AI理解的大型生成文件（如`node_modules`、`dist`目录等）
* 如果您的机器资源有限，考虑在非工作时间进行索引

通过正确设置和维护代码库索引，您可以显著提高Cursor AI助手的效率和准确性，使其成为您开发工作流程中更有价值的工具。 